---
globs: homepage/**
alwaysApply: false
---
# Stream Keys Homepage Development Notes

## Project Overview

This is the marketing homepage for the Stream Keys browser extension. Built with Astro, Tailwind CSS v4, and TypeScript, deployed to Cloudflare Pages.

## Tech Stack

- **Astro** v5.x - Static site generator
- **Tailwind CSS** v4 - CSS-first configuration via `@tailwindcss/vite`
- **TypeScript** - Strict mode enabled
- **Cloudflare Pages** - Static deployment target

## Project Structure

```
/homepage
â”œâ”€â”€ astro.config.mjs       # Astro + Tailwind + Cloudflare + Icon config
â”œâ”€â”€ tsconfig.json          # TypeScript config (extends astro/tsconfigs/strict)
â”œâ”€â”€ public/                # Static assets (images, favicon)
â””â”€â”€ src/
    â”œâ”€â”€ components/        # Astro components
    â”œâ”€â”€ layouts/           # Page layouts
    â”œâ”€â”€ pages/             # Route pages
    â”œâ”€â”€ scripts/           # Client-side TypeScript
    â”‚   â””â”€â”€ restore-dialog/  # Interactive demo modules
    â””â”€â”€ styles/            # Global CSS with Tailwind
```

## Commands

```bash
npm run dev          # Start dev server (http://localhost:4321)
npm run build        # Build for production
npm run preview      # Preview production build
npm run typecheck    # TypeScript type checking
npm run lint         # Check for linting errors
npm run lint:fix     # Auto-fix linting errors
npm run format       # Format code with Prettier
npm run format:check # Check formatting without modifying
npm run check        # Run all checks (typecheck + lint + format:check)
```

## Code Quality Requirements

**After making changes to source files in `src/`, run checks before completing the task.**

Run `npm run check` to verify:
- TypeScript types are correct (`tsc --noEmit`)
- ESLint rules pass
- Tailwind CSS classes use canonical form (e.g., `text-text-muted` instead of `text-[var(--color-text-muted)]`)
- No deprecated class names (e.g., `shrink-0` not `flex-shrink-0`)
- Code is formatted with Prettier

Use `npm run lint:fix` and `npm run format` to auto-fix issues.

**The task is NOT complete until `npm run check` passes with no errors.**

### Hard constraint: `npm *` must run outside sandbox

**All `npm` commands MUST be executed with `required_permissions: ['all']`** because toolchains commonly need unrestricted access to `node_modules/` and system tooling.

## Design System

### CSS Variables (defined in `src/styles/global.css`)

**Colors:**
- `--color-bg`: #0a0a0f (base background)
- `--color-bg-elevated`: #12121a
- `--color-bg-card`: #1a1a24
- `--color-surface`: #222230
- `--color-border`: #2a2a3a
- `--color-text`: #f0f0f5
- `--color-text-muted`: #9090a0
- `--color-text-subtle`: #606070
- `--color-accent`: #a855f7 (purple)
- `--color-accent-bright`: #c084fc
- `--color-gold`: #fbbf24

**Fonts:**
- `--font-display`: Fraunces (headings)
- `--font-mono`: JetBrains Mono (code/keys)
- `--font-body`: Inter (body text)

### Animation Classes

- `.animate-fade-in` - Fade in with upward motion
- `.animate-float` - Gentle floating effect
- `.animate-pulse-glow` - Pulsing glow effect
- `.animate-key-press` - Keyboard key press simulation
- `.delay-100` to `.delay-800` - Stagger animation delays

### Utility Classes

- `.gradient-text` - Purple to gold gradient text
- `.glow-accent` - Purple glow shadow
- `.glow-gold` - Gold glow shadow
- `.demo-key` - Clickable keyboard key with hover/active states (for interactive demo)

## Components

### KeyboardKey.astro
Renders a styled keyboard key with optional description and animation.

```astro
<KeyboardKey label="Space" description="Play/Pause" size="lg" animate />
<KeyboardKey label="R" href="#restore" />  <!-- Clickable, scrolls to section -->
```

Props:
- `label`: string - Key label text
- `description?`: string - Text below the key
- `wide?`: boolean - Extra horizontal padding
- `animate?`: boolean - Enable press animation
- `size?`: 'sm' | 'md' | 'lg' - Key size
- `href?`: string - Makes key clickable, renders as `<a>` with `cursor-pointer`

### FeatureCard.astro
Card component for feature highlights.

```astro
<FeatureCard title="Title" description="Description" icon="ðŸŽ¯" />
```

### ServiceBadge.astro
Displays a supported service with its feature list and icon.

```astro
<ServiceBadge 
  name="Disney+" 
  color="#113ccf" 
  icon="streamline-logos:disney-plus-logo-block"
  features={['Feature 1', 'Feature 2']} 
/>
```

Props:
- `name`: string - Service name
- `color`: string - Brand color (used for hover glow)
- `icon`: string - Iconify icon name
- `features`: string[] - List of supported features

### RestoreDialog.astro
Visual demo of the position restore dialog UI. No props required. Loads client-side script from `src/scripts/restore-dialog/index.ts`.

## Interactive Demo (Restore Dialog)

The homepage includes a fully interactive demo of the position restore feature. Located in `src/scripts/restore-dialog/`:

```
restore-dialog/
â”œâ”€â”€ index.ts         # Entry point, initialization
â”œâ”€â”€ config.ts        # Constants, video list, position generation
â”œâ”€â”€ state.ts         # State management (positions, current time, dialog state)
â”œâ”€â”€ types.ts         # TypeScript interfaces
â”œâ”€â”€ events.ts        # Custom events (timeupdate, historychange, closedialog)
â”œâ”€â”€ time.ts          # Time formatting utilities
â”œâ”€â”€ positions.ts     # Position list rendering and management
â”œâ”€â”€ dialog.ts        # Dialog open/close/toggle
â”œâ”€â”€ keyboard.ts      # Keyboard shortcuts (R, S, Escape, 0-9)
â”œâ”€â”€ banner.ts        # Banner notification display
â”œâ”€â”€ progress-bar.ts  # Fake video progress bar with drag support
â””â”€â”€ visibility.ts    # Intersection Observer for scoped shortcuts
```

### Key Patterns

**Visibility-scoped shortcuts**: Keyboard shortcuts only work when the demo section (`#restore`) is visible. Uses `IntersectionObserver` in `visibility.ts`.

**Custom events**: Components communicate via custom events dispatched on `window`:
- `streamkeys:timeupdate` - Progress bar time changed
- `streamkeys:historychange` - Position history modified
- `streamkeys:closedialog` - Request to close dialog

**Demo key buttons**: Clickable R/S buttons in the left column trigger the same actions as keyboard shortcuts. IDs: `demo-key-r`, `demo-key-s`.

**Random content**: Video titles and initial positions are randomized on load and reset. See `VIDEOS` array and `getRandomVideoSeconds()` in `config.ts`.

## Icons (Astro Icon + Iconify)

Uses `astro-icon` with Iconify icon sets. Icons are tree-shaken - only used icons are bundled.

```astro
import { Icon } from "astro-icon/components";

<Icon name="logos:chrome" class="w-6 h-6" />
<Icon name="streamline-logos:disney-plus-logo-block" class="w-6 h-6" />
```

Installed icon sets:
- `@iconify-json/logos` - Browser logos (Chrome, Firefox, Safari, Edge)
- `@iconify-json/streamline-logos` - Service logos (Disney+, HBO Max, BBC iPlayer, YouTube)

## Tailwind v4 Notes

This project uses Tailwind CSS v4 with the Vite plugin:
- No `tailwind.config.js` needed - uses CSS-first configuration
- Theme customization via `@theme` directive in `global.css`
- Import with `@import "tailwindcss"` in CSS files

### Use Canonical Class Names

**Always use canonical Tailwind class names instead of arbitrary value syntax.**

When colors/fonts are defined in `@theme`, Tailwind generates native utility classes:

| Instead of (arbitrary/deprecated)       | Use (canonical)    |
|-----------------------------------------|--------------------|
| `text-[var(--color-text-muted)]`        | `text-text-muted`  |
| `bg-[var(--color-bg-card)]`             | `bg-bg-card`       |
| `border-[var(--color-border)]`          | `border-border`    |
| `font-[family-name:var(--font-display)]`| `font-display`     |
| `flex-shrink-0`                         | `shrink-0`         |
| `flex-grow`                             | `grow`             |
| `overflow-ellipsis`                     | `text-ellipsis`    |
| `overflow-clip`                         | `text-clip`        |

The linter (`npm run lint`) warns about non-canonical classes. Additionally, `npm run lint:classes` checks for deprecated Tailwind v3 class names.

## Cloudflare Pages Deployment

Build settings:
- **Build command**: `npm run build`
- **Output directory**: `dist`
- **Node.js version**: 25.x (matches `.node-version`)

The `@astrojs/cloudflare` adapter is configured for static output.

## Best Practices

1. **Components**: Keep components in `src/components/`, use `.astro` extension
2. **Styling**: Use Tailwind utilities, fall back to CSS variables for consistency
3. **Images**: Place in `public/images/`, reference with `/images/...`
4. **Animations**: Prefer CSS animations over JavaScript for performance
5. **Accessibility**: Include proper ARIA labels and semantic HTML
